<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CreateYouPC - Crea tu PC ideal con IA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <i class="fas fa-desktop"></i>
                    <span>CreateYouPC</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="#home">Inicio</a></li>
                    <li><a href="#build">Crear Build</a></li>
                    <li><a href="#about">Acerca de</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Crea tu PC ideal con <span class="highlight">Inteligencia Artificial</span></h1>
                <p>Diseña la configuración perfecta para tu presupuesto y necesidades. Nuestra IA selecciona los mejores componentes compatibles.</p>
                <a href="#build" class="cta-button">
                    <i class="fas fa-rocket"></i>
                    Crear mi PC ahora
                </a>
            </div>
            <div class="hero-image">
                <i class="fas fa-laptop-code"></i>
            </div>
        </div>
    </section>

    <!-- Build Section -->
    <section id="build" class="build-section">
        <div class="container">
            <h2>Configura tu Build</h2>
            <div class="build-container">
                <div class="form-section">
                    <form id="buildForm" class="build-form">
                        <div class="form-group">
                            <label for="budget">
                                <i class="fas fa-dollar-sign"></i>
                                Presupuesto (USD)
                            </label>
                            <input type="number" id="budget" name="budget" min="200" max="10000" step="50" required>
                            <small>Mínimo: $200 - Máximo: $10,000</small>
                        </div>

                        <div class="form-group">
                            <label for="useType">
                                <i class="fas fa-gamepad"></i>
                                Tipo de uso
                            </label>
                            <select id="useType" name="useType" required>
                                <option value="">Selecciona el uso principal</option>
                                <option value="gaming">Gaming / Juegos</option>
                                <option value="design">Diseño / Creatividad</option>
                                <option value="office">Oficina / Trabajo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="brands">
                                <i class="fas fa-tags"></i>
                                Marcas preferidas (opcional)
                            </label>
                            <input type="text" id="brands" name="brands" placeholder="Ej: NVIDIA, AMD, Intel">
                            <small>Separa múltiples marcas con comas</small>
                        </div>

                        <button type="submit" class="submit-btn">
                            <i class="fas fa-cog"></i>
                            Generar Build
                        </button>
                    </form>
                </div>

                <div class="result-section">
                    <div id="loading" class="loading hidden">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Generando tu build perfecta...</p>
                    </div>

                    <div id="result" class="result hidden">
                        <h3>Tu Build Sugerida</h3>
                        <div class="build-summary">
                            <div class="summary-item">
                                <span class="label">Costo total:</span>
                                <span id="totalCost" class="value">$0</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Presupuesto usado:</span>
                                <span id="budgetUsed" class="value">0%</span>
                            </div>
                            <div class="summary-item">
                                <span class="label">Tipo de uso:</span>
                                <span id="buildType" class="value">-</span>
                            </div>
                        </div>
                        <div id="componentsList" class="components-list"></div>
                    </div>

                    <div id="error" class="error hidden">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p id="errorMessage">Ha ocurrido un error</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <h2>¿Cómo funciona?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <i class="fas fa-brain"></i>
                    <h3>IA Inteligente</h3>
                    <p>Nuestro algoritmo analiza tu presupuesto y necesidades para seleccionar los mejores componentes.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-puzzle-piece"></i>
                    <h3>Compatibilidad</h3>
                    <p>Garantizamos que todos los componentes sean compatibles entre sí para un funcionamiento óptimo.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-chart-line"></i>
                    <h3>Mejor Rendimiento</h3>
                    <p>Optimizamos cada build para obtener el máximo rendimiento dentro de tu presupuesto.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <i class="fas fa-desktop"></i>
                    <span>CreateYouPC</span>
                </div>
                <p>&copy; 2024 CreateYouPC. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // Configuración de la aplicación
        const API_BASE_URL = '/api';

        // Referencias a elementos del DOM
        const buildForm = document.getElementById('buildForm');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');
        const error = document.getElementById('error');
        const totalCost = document.getElementById('totalCost');
        const budgetUsed = document.getElementById('budgetUsed');
        const buildType = document.getElementById('buildType');
        const componentsList = document.getElementById('componentsList');
        const errorMessage = document.getElementById('errorMessage');

        // Función para mostrar/ocultar elementos
        function showElement(element) {
            element.classList.remove('hidden');
        }

        function hideElement(element) {
            element.classList.add('hidden');
        }

        // Función para mostrar error
        function showError(message) {
            errorMessage.textContent = message;
            hideElement(loading);
            hideElement(result);
            showElement(error);
        }

        // Función para mostrar loading
        function showLoading() {
            hideElement(result);
            hideElement(error);
            showElement(loading);
        }

        // Función para crear card de componente
        function createComponentCard(component, type) {
            const typeNames = {
                'cpu': 'Procesador',
                'gpu': 'Tarjeta Gráfica',
                'ram': 'Memoria RAM',
                'storage': 'Almacenamiento',
                'motherboard': 'Motherboard',
                'psu': 'Fuente de Poder'
            };

            const icons = {
                'cpu': 'fas fa-microchip',
                'gpu': 'fas fa-tv',
                'ram': 'fas fa-memory',
                'storage': 'fas fa-hdd',
                'motherboard': 'fas fa-project-diagram',
                'psu': 'fas fa-plug'
            };

            return `
                <div class="component-card">
                    <div class="component-header">
                        <i class="${icons[type]}"></i>
                        <span class="component-type">${typeNames[type]}</span>
                    </div>
                    <h4 class="component-name">${component.name}</h4>
                    <div class="component-price">$${component.price}</div>
                    <a href="${component.buy_link}" target="_blank" class="buy-button">
                        <i class="fas fa-shopping-cart"></i>
                        Comprar
                    </a>
                </div>
            `;
        }

        // Función para mostrar resultado
        function showResult(data) {
            hideElement(loading);
            hideElement(error);

            // Actualizar resumen
            totalCost.textContent = `$${data.total_cost.toFixed(2)}`;
            budgetUsed.textContent = `${data.budget_used.toFixed(1)}%`;
            buildType.textContent = data.use_type.charAt(0).toUpperCase() + data.use_type.slice(1);

            // Actualizar lista de componentes
            componentsList.innerHTML = '';
            const components = data.components;
            
            Object.keys(components).forEach(type => {
                const componentHtml = createComponentCard(components[type], type);
                componentsList.innerHTML += componentHtml;
            });

            showElement(result);
        }

        // Función para procesar el formulario
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            // Obtener datos del formulario
            const formData = new FormData(buildForm);
            const budget = parseFloat(formData.get('budget'));
            const useType = formData.get('useType');
            const brandsStr = formData.get('brands');
            
            // Procesar marcas preferidas
            const preferredBrands = brandsStr ? 
                brandsStr.split(',').map(brand => brand.trim()).filter(brand => brand.length > 0) : 
                [];

            // Validar datos
            if (!budget || budget < 200) {
                showError('El presupuesto debe ser de al menos $200');
                return;
            }

            if (!useType) {
                showError('Selecciona un tipo de uso');
                return;
            }

            showLoading();

            try {
                // Enviar solicitud al backend
                const response = await fetch(`${API_BASE_URL}/build`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        budget: budget,
                        use_type: useType,
                        preferred_brands: preferredBrands
                    })
                });

                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.success) {
                    showResult(data);
                } else {
                    showError(data.error || 'No se pudo generar la build');
                }
            } catch (err) {
                console.error('Error:', err);
                showError('Error de conexión. Verifica que el servidor esté funcionando.');
            }
        }

        // Función para scroll suave
        function smoothScroll(target) {
            const element = document.querySelector(target);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Event listeners
        buildForm.addEventListener('submit', handleFormSubmit);

        // Smooth scroll para navegación
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = this.getAttribute('href');
                smoothScroll(target);
            });
        });

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CreateYouPC App initialized');
            
            // Verificar que la API esté funcionando
            fetch(`${API_BASE_URL}/health`)
                .then(response => response.json())
                .then(data => {
                    console.log('API Status:', data.message);
                })
                .catch(err => {
                    console.warn('API no disponible:', err);
                });
        });
    </script>
</body>
</html>